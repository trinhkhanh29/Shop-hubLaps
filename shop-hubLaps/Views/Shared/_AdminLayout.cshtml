@using Microsoft.AspNetCore.Identity
@using shop_hubLaps.Areas.Identity.Data
@inject UserManager<SampleUser> UserManager

@{
    var currentUser = await UserManager.GetUserAsync(User);
    string currentProfilePicturePath = currentUser?.Avatar ?? "/img/avt.user.svg";
    string currentFullName = $"{currentUser?.FirstName} {currentUser?.LastName}";
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation-unobtrusive@3.2.12/dist/jquery.validate.unobtrusive.min.js"></script>
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - Admin Dashboard</title>

    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="~/css_chude/_adminlayout.css" rel="stylesheet" />
    <link href="~/css/alert-notifications.css" rel="stylesheet" />

    <style>
        @@media (max-width: 990px) {
    .sidebar {
        width: 100%;
        height: 90%;
        position: relative;
        min-width: unset;
    }
    .bg-light{
        background-color: #f8f8f8;
    } 
    </style>
</head>

<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar">
            <div class="admin-info text-center">
                <img src="@currentProfilePicturePath" alt="Avatar" class="img-thumbnail rounded-circle mb-3">
                <h5>@currentFullName</h5>
                <p class="text-muted">Admin</p>
                <a href="/Identity/Account/Manage" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-user-edit"></i> Chỉnh sửa tài khoản
                </a>
            </div>

            <ul class="nav flex-column mt-4">
                <li class="nav-item">
                    <a class="nav-link" href="@Url.Action("Index", "Dashboard")">
                        <i class="fas fa-tachometer-alt"></i> Bảng điều khiển
                    </a>
                </li>
                <li class="nav-item menu-item menu-accordion">
                    <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse" href="#productMenu" role="button" aria-expanded="false">
                        <i class="fas fa-laptop"></i> <span>Sản phẩm</span>
                        <i class="fas fa-chevron-right ms-auto"></i>
                    </a>
                    <div class="collapse submenu" id="productMenu">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a href="@Url.Action("Index", "Product")" class="nav-link">Danh sách sản phẩm</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Create", "Product")" class="nav-link">Thêm sản phẩm mới</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Index", "Hang")" class="nav-link">Hãng Laptop</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Index", "NhuCau")" class="nav-link">Nhu cầu</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Index", "DanhGia")" class="nav-link">Đánh giá</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Index", "MetaLaptop")" class="nav-link">Meta Laptop</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Edit", "Product")" class="nav-link">Sửa sản phẩm</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Delete", "Product")" class="nav-link">Xóa sản phẩm</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <!-- Quản lý chủ đề -->
                <li class="nav-item menu-item menu-accordion">
                    <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse" href="#chuDeMenu" role="button" aria-expanded="false">
                        <i class="fas fa-tags"></i> <span>Chủ đề</span>
                        <i class="fas fa-chevron-right ms-auto"></i>
                    </a>
                    <div class="collapse submenu" id="chuDeMenu">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a href="@Url.Action("Index", "ChuDe")" class="nav-link">Danh sách chủ đề</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Create", "ChuDe")" class="nav-link">Thêm chủ đề mới</a>
                            </li>                
                        </ul>
                    </div>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="@Url.Action("Index", "Orders")">
                        <i class="fas fa-shopping-cart"></i> Đơn hàng
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="@Url.Action("Index", "Customers")">
                        <i class="fas fa-users"></i> Khách hàng
                    </a>
                </li>
                <!-- Quản lý quảng cáo -->
                <li class="nav-item menu-item menu-accordion">
                    <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse" href="#adsMenu" role="button" aria-expanded="false">
                        <i class="fas fa-bullhorn"></i> <span>Quảng cáo</span>
                        <i class="fas fa-chevron-right ms-auto"></i>
                    </a>
                    <div class="collapse submenu" id="adsMenu">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a href="@Url.Action("Index", "Ads")" class="nav-link">Danh sách quảng cáo</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Create", "Ads")" class="nav-link">Thêm quảng cáo</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <!-- Quản lý nhu cầu -->
                <li class="nav-item">
                    <a class="nav-link" href="@Url.Action("Index", "NhuCau")">
                        <i class="fas fa-list"></i> Nhu cầu
                    </a>
                </li>
                <!-- Quản lý bài viết -->
                <li class="nav-item menu-item menu-accordion">
                    <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse" href="#blogMenu" role="button" aria-expanded="false">
                        <i class="fas fa-newspaper"></i> <span>Bài viết</span>
                        <i class="fas fa-chevron-right ms-auto"></i>
                    </a>
                    <div class="collapse submenu" id="blogMenu">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a href="@Url.Action("Index", "Posts")" class="nav-link">Danh sách bài viết</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Create", "Posts")" class="nav-link">Thêm bài viết</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <!-- Quản lý tin tức -->
                <li class="nav-item menu-item menu-accordion">
                    <a class="nav-link d-flex align-items-center" data-bs-toggle="collapse" href="#newsMenu" role="button" aria-expanded="false">
                        <i class="fas fa-newspaper"></i> <span>Tin Tức</span>
                        <i class="fas fa-chevron-right ms-auto"></i>
                    </a>
                    <div class="collapse submenu" id="newsMenu">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a href="@Url.Action("Index", "TinTuc")" class="nav-link">Danh sách tin tức</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Create", "TinTuc")" class="nav-link">Thêm tin tức</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <!-- Quản lý bình luận -->
                <li class="nav-item">
                    <a class="nav-link" href="@Url.Action("Index", "Comments")">
                        <i class="fas fa-comments"></i> Bình luận
                    </a>
                </li>
                <!-- Quản lý vai trò thành viên -->
                <li class="nav-item">
                    <a class="nav-link" href="@Url.Action("Index", "Roles")">
                        <i class="fas fa-user-shield"></i> Vai trò thành viên
                    </a>
                </li>
                <!-- Quản lý chi tiết đơn hàng -->
                <li class="nav-item">
                    <a class="nav-link" href="@Url.Action("Index", "OrderDetails")">
                        <i class="fas fa-file-invoice"></i> Chi tiết đơn hàng
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-danger" href="/Identity/Account/Logout">
                        <i class="fas fa-sign-out-alt"></i> Đăng xuất
                    </a>
                </li>
            </ul>

        </div>

        <!-- Content -->
        <div class="content">
            <nav class="navbar navbar-light bg-light mb-3">
                <div class="container-fluid">
                    <button class="btn btn-primary toggle-menu" type="button">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h4 class="mb-0">@ViewBag.PageTitle</h4>
                </div>
            </nav>
            @RenderBody()
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const toggleButton = document.querySelector('.toggle-menu');
            const sidebar = document.getElementById('sidebar');
            const content = document.querySelector('.content');

            // Toggle sidebar visibility
            toggleButton.addEventListener('click', function () {
                sidebar.classList.toggle('hidden');
                content.classList.toggle('expanded');
            });
            document.addEventListener('DOMContentLoaded', function () {
                const accordionLinks = document.querySelectorAll('.menu-item.menu-accordion .nav-link');
                accordionLinks.forEach(link => {
                    link.addEventListener('click', function (e) {
                        e.preventDefault();
                        const parentItem = this.closest('.menu-item.menu-accordion');
                        const submenu = parentItem.querySelector('.submenu');

                        // Toggle submenu
                        if (submenu) {
                            submenu.classList.toggle('show');
                        }
                    });
                });
            });
        });
        document.addEventListener("DOMContentLoaded", function () {
            const showMessage = (message, type = "success") => {
                let container = document.querySelector(".message-container");
                if (!container) {
                    container = document.createElement("div");
                    container.className = "message-container";
                    document.body.appendChild(container);
                }

                const messageBox = document.createElement("div");
                messageBox.className = `message-box message-box-${type}`;
                messageBox.innerHTML = `
                        <i class="fa ${type === "success" ? "fa-check" : "fa-ban"} fa-2x"></i>
                        <span class="message-text"><strong>${type.charAt(0).toUpperCase() + type.slice(1)}:</strong> ${message}</span>
                        <i class="fa fa-times fa-2x exit-button"></i>
                    `;

                messageBox.querySelector(".exit-button").addEventListener("click", function () {
                    messageBox.remove();
                });

                container.appendChild(messageBox);

                setTimeout(() => {
                    messageBox.remove();
                }, 5000);
            };

       // Hiển thị lỗi từ TempData nếu có
        @if (TempData["SuccessMessage"] != null)
        {
            @:showMessage("@TempData["SuccessMessage"]", "success");
        }

        @if (TempData["ErrorMessage"] != null)
        {
            @:showMessage("@TempData["ErrorMessage"]", "error");
        }

        // Hiển thị thông báo lỗi chi tiết từ ModelState (nếu có)
        @if (TempData["ValidationErrors"] != null)
        {
            @:showMessage("@TempData["ValidationErrors"]", "error");
        }
              });
    </script>
    @RenderSection("Scripts", required: false)

</body>
</html>
