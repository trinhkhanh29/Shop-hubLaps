@model IEnumerable<shop_hubLaps.Models.DonHang>
@using shop_hubLaps.Views.Laptop

@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Danh sách Đơn hàng";
}

<h1 class="text-start" style="font-family: Lexend;font-weight: 500;font-size: 30px;">@ViewData["Title"]</h1>

<a asp-action="Create" class="btn btn-primary mb-3">
    <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11.9944 10.0011L11.9944 13.9989" stroke="#ffffff" stroke-width="1.69904" stroke-linecap="round" style=""></path>
        <path d="M13.9932 12H9.99541" stroke="#ffffff" stroke-width="1.69904" stroke-linecap="round" style=""></path>
        <path d="M20.845 12V6.50968C20.845 4.48821 19.2062 2.84949 17.1848 2.84949H6.50419C4.48272 2.84949 2.84399 4.48821 2.84399 6.50968V17.4903C2.84399 19.5117 4.48272 21.1504 6.50419 21.1504H11.8445" stroke="#ffffff" stroke-width="1.69904" stroke-linecap="round" style=""></path>
        <path d="M20.7847 15.8827L18.8316 13.8971C18.6335 13.6957 18.3123 13.6957 18.1142 13.8971L14.3579 17.716C14.2491 17.8266 14.1956 17.9813 14.2123 18.1368L14.4272 20.1323C14.4401 20.2525 14.5334 20.3474 14.6517 20.3605L16.6145 20.5789C16.7673 20.5959 16.9196 20.5415 17.0283 20.431L20.7847 16.612C20.9828 16.4106 20.9828 16.0841 20.7847 15.8827Z" stroke="#ffffff" stroke-width="1.69904" stroke-linecap="round" style=""></path>
    </svg> Thêm mới Đơn hàng
</a>
<!-- Tìm kiếm và Bộ lọc -->
<div class="mb-3">
    <!-- Search Form -->
    <div class="d-flex justify-content-center w-100 mb-3" style="max-width: 600px; margin: 0 auto;">
        <form method="get" asp-action="Index" class="w-100">
            <div class="row g-3 align-items-center">
                <div class="col-12 col-md-8">
                    <input type="text" name="searchTerm" class="form-control" placeholder="Tìm kiếm theo Tên Hãng hoặc Tên Laptop" value="@Context.Request.Query["searchTerm"]" />
                </div>
                <div class="col-12 col-md-4">
                    <button type="submit" class="btn btn-primary w-100">
                        Tìm kiếm
@*                         <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="search" fill="#fff" style="">
                                <g id="search_2" fill="#fff" style="">
                                    <path id="Combined Shape" fill-rule="evenodd" clip-rule="evenodd" d="M33.2768 28.9321C34.9961 26.3812 35.9996 23.3078 35.9996 19.9994C35.9996 11.1624 28.8372 3.9994 19.9996 3.9994C11.1633 3.9994 3.99957 11.1631 3.99957 19.9994C3.99957 28.837 11.1626 35.9994 19.9996 35.9994C24.8047 35.9994 29.1142 33.8826 32.0467 30.5304L41.6591 40.1427C42.0745 40.5582 42.0745 41.229 41.6591 41.6445C41.4569 41.8467 41.1888 41.9556 40.9102 41.9556C40.6297 41.9556 40.3616 41.8468 40.1593 41.6445L32.6653 34.1505C32.2748 33.76 31.6416 33.76 31.2511 34.1505C30.8605 34.541 30.8605 35.1742 31.2511 35.5647L38.7451 43.0587C39.3261 43.6398 40.1044 43.9556 40.9102 43.9556C41.7144 43.9556 42.4925 43.6395 43.0733 43.0587C44.2698 41.8622 44.2698 39.925 43.0733 38.7285L33.2768 28.9321ZM31.8319 27.4872C33.2048 25.3219 33.9996 22.7537 33.9996 19.9994C33.9996 12.267 27.7326 5.9994 19.9996 5.9994C12.2679 5.9994 5.99957 12.2677 5.99957 19.9994C5.99957 27.7324 12.2671 33.9994 19.9996 33.9994C24.2525 33.9994 28.0616 32.1044 30.6289 29.1126L28.3871 26.8707C27.9965 26.4802 27.9965 25.847 28.3871 25.4565C28.7776 25.066 29.4108 25.066 29.8013 25.4565L31.8319 27.4872ZM25.4238 28.4021C23.8214 29.4393 21.9526 29.9996 19.9992 29.9996C14.4767 29.9996 9.99917 25.5226 9.99917 19.9996C9.99917 19.4473 9.55146 18.9996 8.99917 18.9996C8.44689 18.9996 7.99917 19.4473 7.99917 19.9996C7.99917 26.6272 13.3722 31.9996 19.9992 31.9996C22.3411 31.9996 24.5867 31.3263 26.5105 30.0811C26.9742 29.781 27.1068 29.1619 26.8067 28.6982C26.5066 28.2346 25.8874 28.102 25.4238 28.4021Z" fill="#fff" style=""></path>
                                </g>
                            </g>
                        </svg> *@
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Filters -->
    <div class="d-flex justify-content-center w-100" style="max-width: 900px; margin: 0 auto;">
        <div class="row w-100 g-3">
            <div class="col-12 col-md-4">
                <select id="filterLaptop" class="form-control" style="font-size: 17px;">
                    <option value="">Bộ lọc theo Tên Laptop</option>
                    @foreach (var tenlaptop in ViewData["Laptops"] as List<string>)
                    {
                        <option value="@tenlaptop">@tenlaptop</option>
                    }
                </select>
            </div>

            <div class="col-12 col-md-4">
                <select id="filterDate" class="form-control" style="font-size: 17px;">
                    <option value="">Bộ lọc theo Ngày</option>
                    <option value="newest">Mới nhất đến Cũ nhất</option>
                    <option value="oldest">Cũ nhất đến Mới nhất</option>
                </select>
            </div>

            <div class="col-12 col-md-4">
                <select id="filterStatus" class="form-control" style="font-size: 17px;">
                    <option value="">Bộ lọc theo Tình Trạng</option>
                    <option value="PENDING">Chờ xử lý</option>
                    <option value="PROCESSING">Đang xử lý đơn hàng</option>
                    <option value="CART">Giỏ hàng</option>
                    <option value="SHIPPED">Đã giao hàng</option>
                    <option value="DELIVERED">Đã giao hàng thành công</option>
                    <option value="COMPLETED">Hoàn thành</option>
                    <option value="REFUNDED">Đã hoàn tiền</option>
                    <option value="CANCELLED">Đã hủy</option>
                </select>
            </div>
        </div>
    </div>
</div>
<div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
        <thead class="thead-dark">
            <tr>
                <th>Mã Đơn</th>     
                <th>Mã Khách Hàng</th>
                <th>Tên Laptop</th>
                <th>Ngày Đặt</th>
                <th>Tổng Giá</th>
                <th>Tình Trạng</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="orderTableBody">
            @foreach (var item in Model)
            {
                <tr>
                    <td data-madon="@item.madon">@item.madon</td>
                    <td data-makh="@item.makh">@item.makh</td>
                    <td data-laptopnames="@string.Join(", ", item.ChiTietDonHangs.Select(ct => ct.Laptop?.tenlaptop ?? "No Laptop Information"))">
                        @foreach (var chiTiet in item.ChiTietDonHangs)
                        {
                            @if (chiTiet.Laptop != null)
                            {
                                <p>@chiTiet.Laptop.tenlaptop</p>
                            }
                            else
                            {
                                <p>No Laptop Information</p>
                            }
                        }
                    </td>
                    <td data-ngaydat="@item.ngaydat">@item.ngaydat</td>
                    <td>@item.gia</td>
                    @* <td data-tinhtrang="@item.tinhtrang" class="@GetStatusClass(item.tinhtrang) ">
                        @item.tinhtrang
                    </td> *@
                    <td class="text-center">
                        <span class="@GetStatusClass(item.tinhtrang)">
                            @item.tinhtrang
                        </span>
                    </td>

                    <td class="text-center">
                        <a asp-action="Details" asp-route-id="@item.madon" class="btn btn-info btn-sm m-1" title="Chi Tiết Đơn hàng">
                            <svg width="24" height="24" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.288 1.969c-.742 0-1.32.577-1.32 1.32v9.423c0 .742.578 1.32 1.32 1.32h9.424c.742 0 1.32-.578 1.32-1.32V3.288c0-.742-.578-1.32-1.32-1.32zM7 4h2v2H7zm0 3h2v5H7z" style="" color="#bebebe" overflow="visible" fill="#fff"></path>
                            </svg>
                        </a>
                        <a asp-action="Edit" asp-route-id="@item.madon" class="btn btn-warning btn-sm m-1" title="Sửa Đơn hàng">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" fill="#ffffff" style=""></path>
                                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" fill="#ffffff" style=""></path>
                            </svg>
                        </a>
                        <a asp-action="Delete" asp-route-id="@item.madon" class="btn btn-danger btn-sm m-1" title="Xóa Đơn hàng">
                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 48 48">
                                <path d="M 24 4 C 20.604985 4 17.871931 6.6709362 17.601562 10 L 6.5 10 A 1.50015 1.50015 0 1 0 6.5 13 L 8.1796875 13 L 11.5625 39.203125 C 11.9155 41.937125 14.261578 44 17.017578 44 L 23.632812 44 C 22.777812 43.111 22.050609 42.103 21.474609 41 L 17.015625 41 C 15.762625 41 14.698109 40.062312 14.537109 38.820312 L 11.205078 13 L 36.792969 13 L 35.599609 22.261719 C 36.616609 22.467719 37.583047 22.803422 38.498047 23.232422 L 39.818359 13 L 41.5 13 A 1.50015 1.50015 0 1 0 41.5 10 L 30.398438 10 C 30.128069 6.6709362 27.395015 4 24 4 z M 24 7 C 25.772042 7 27.151946 8.3030508 27.400391 10 L 20.599609 10 C 20.848054 8.3030508 22.227958 7 24 7 z M 33 24 C 26.925 24 22 28.925 22 35 C 22 41.075 26.925 46 33 46 C 39.075 46 44 41.075 44 35 C 44 28.925 39.075 24 33 24 z M 38 29 C 38.113381 29 38.225927 29.026067 38.333984 29.064453 C 38.372415 29.078124 38.408457 29.098672 38.445312 29.117188 C 38.538084 29.163988 38.629616 29.215355 38.707031 29.292969 C 38.789242 29.37518 38.844938 29.473166 38.892578 29.572266 C 38.906306 29.60097 38.92276 29.628569 38.933594 29.658203 C 39.014602 29.879437 39.016065 30.120631 38.935547 30.341797 C 38.923651 30.374422 38.904075 30.404058 38.888672 30.435547 C 38.841334 30.532092 38.787445 30.626823 38.707031 30.707031 L 34.414062 35 C 36.609063 37.194 38.619031 39.204969 38.707031 39.292969 C 38.785789 39.371727 38.837736 39.466115 38.884766 39.560547 C 38.901871 39.595129 38.922686 39.628108 38.935547 39.664062 C 38.974758 39.77326 39 39.885407 39 40 C 39 40.113381 38.973933 40.225927 38.935547 40.333984 C 38.921876 40.372415 38.901328 40.408457 38.882812 40.445312 C 38.836012 40.538084 38.784645 40.629616 38.707031 40.707031 C 38.62482 40.789242 38.526834 40.844938 38.427734 40.892578 C 38.39903 40.906306 38.371431 40.92276 38.341797 40.933594 C 38.120563 41.014602 37.879369 41.016065 37.658203 40.935547 C 37.625578 40.923651 37.595942 40.904075 37.564453 40.888672 C 37.467908 40.841334 37.373177 40.787445 37.292969 40.707031 L 33 36.414062 L 28.707031 40.707031 C 28.628273 40.785789 28.533885 40.837736 28.439453 40.884766 C 28.404871 40.901871 28.371892 40.922686 28.335938 40.935547 C 28.22674 40.974758 28.114593 41 28 41 C 27.886619 41 27.774073 40.973933 27.666016 40.935547 C 27.627585 40.921876 27.591543 40.901328 27.554688 40.882812 C 27.461916 40.836012 27.370384 40.784645 27.292969 40.707031 C 27.210758 40.62482 27.155062 40.526834 27.107422 40.427734 C 27.093694 40.39903 27.07724 40.371431 27.066406 40.341797 C 26.985398 40.120563 26.983935 39.879369 27.064453 39.658203 C 27.076349 39.625578 27.095925 39.595942 27.111328 39.564453 C 27.158666 39.467908 27.212555 39.373177 27.292969 39.292969 C 27.380969 39.204969 29.390937 37.194 31.585938 35 L 27.292969 30.707031 C 27.214211 30.628273 27.162264 30.533885 27.115234 30.439453 C 27.098129 30.404871 27.077314 30.371892 27.064453 30.335938 C 27.025242 30.22674 27 30.114593 27 30 C 27 29.886619 27.026067 29.774073 27.064453 29.666016 C 27.078124 29.627585 27.098672 29.591543 27.117188 29.554688 C 27.163988 29.461916 27.215355 29.370384 27.292969 29.292969 C 27.386602 29.199336 27.4966 29.13082 27.611328 29.082031 C 27.629124 29.074484 27.647891 29.070919 27.666016 29.064453 C 27.761325 29.03044 27.859087 29.011988 27.958984 29.007812 C 27.981138 29.006893 28.003225 29.003359 28.025391 29.003906 C 28.138738 29.006803 28.252148 29.027077 28.359375 29.068359 C 28.377732 29.075451 28.394117 29.087486 28.412109 29.095703 C 28.518081 29.144025 28.619906 29.205621 28.707031 29.292969 C 28.795031 29.380969 30.806 31.390937 33 33.585938 L 37.292969 29.292969 C 37.371727 29.214211 37.466115 29.162264 37.560547 29.115234 C 37.595129 29.098129 37.628108 29.077314 37.664062 29.066406 C 37.77326 29.025242 37.885407 29 38 29 z" fill="#ffffff"></path>
                            </svg>
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

    <script>

    document.getElementById('filterLaptop').addEventListener('change', applyFilters);
    document.getElementById('filterDate').addEventListener('change', applyFilters);
    document.getElementById('filterStatus').addEventListener('change', applyFilters);

    function applyFilters() {
        const laptopFilter = document.getElementById('filterLaptop').value;
        const dateFilter = document.getElementById('filterDate').value;
        const statusFilter = document.getElementById('filterStatus').value;

        const params = new URLSearchParams();

        if (laptopFilter) params.append('laptopFilter', laptopFilter);
        if (dateFilter) params.append('dateFilter', dateFilter);
        if (statusFilter) params.append('statusFilter', statusFilter);

        const url = `/DonHang/Index?${params.toString()}`;
        window.location.href = url;
    }

        @functions {
        public string GetStatusClass(string status)
        {
            switch (status)
            {
                case "COMPLETED":
                    return "badge bg-success text-white"; // Green
                case "REFUNDED":
                    return "badge bg-warning text-dark"; // Yellow
                case "CANCELLED":
                    return "badge bg-danger text-white"; // Red
                case "DELIVERED":
                    return "badge bg-info text-white"; // Light Blue
                case "SHIPPED":
                    return "badge bg-primary text-white"; // Blue
                case "PENDING":
                    return "badge bg-secondary text-white"; // Gray
                case "PROCESSING":
                    return "badge bg-dark text-white"; // Dark
                case "CART":
                    return "badge bg-light text-dark"; // Light
                default:
                    return "badge bg-light text-dark"; // Default light color
            }
        }
    }


    
    </script>

